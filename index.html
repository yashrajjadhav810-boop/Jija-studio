<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jija Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root { --primary: #D81B60; --dark: #1e293b; --light: #f8fafc; --white: #ffffff; --green: #10b981; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background: var(--light); padding-bottom: 80px; }
        
        /* HEADER */
        header { background: var(--primary); padding: 15px; display: flex; justify-content: space-between; align-items: center; color: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .logo { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.2rem; }
        .logo img { height: 35px; border-radius: 50%; border: 2px solid white; }
        .icon-btn { background: none; border: none; color: white; font-size: 1.4rem; cursor: pointer; position: relative; margin-left: 10px; }
        .badge { position: absolute; top: -5px; right: -5px; background: white; color: var(--primary); font-size: 0.7rem; font-weight: bold; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* PRODUCT CARD */
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; cursor: pointer; transition: 0.3s; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .card-img-wrap { position: relative; }
        .card img { width: 100%; height: 220px; object-fit: cover; }
        .wish-icon { position: absolute; top: 10px; right: 10px; background: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 5; transition: 0.2s; }
        .wish-icon.active { color: var(--primary); }
        
        .info { padding: 10px; }
        .title { font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .price { font-weight: 700; font-size: 1.1rem; }

        /* PROFESSIONAL ADDRESS FORM */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
        .form-full { width: 100%; margin-bottom: 12px; }
        .form-label { font-size: 0.75rem; font-weight: 600; color: #64748b; margin-bottom: 4px; display: block; }
        .form-input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-family: inherit; font-size: 0.9rem; box-sizing: border-box; }
        .form-input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 2px rgba(216,27,96,0.1); }
        .form-input[disabled] { background: #e2e8f0; color: #64748b; cursor: not-allowed; }

        /* MODALS */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; }
        .modal-box { background: white; width: 90%; max-width: 500px; max-height: 90vh; border-radius: 15px; overflow-y: auto; position: relative; padding: 20px; }
        
        .btn-full { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; font-weight: 600; font-size: 1rem; cursor: pointer; border-radius: 8px; margin-top: 10px; }
        
        /* ANIMATION PARTICLES */
        .theme-particle { position: fixed; top: -10%; user-select: none; pointer-events: none; z-index: 5000; animation: fall linear forwards; opacity: 0.9; }
        @keyframes fall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(110vh) rotate(360deg); opacity: 0; } }

        /* GRID & TABS CSS from previous ... */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; padding: 15px; }
        .tabs { display: flex; gap: 10px; padding: 10px 15px; overflow-x: auto; scrollbar-width: none; background: white; }
        .tab-btn { padding: 8px 18px; border: 1px solid #eee; background: white; border-radius: 30px; font-size: 0.9rem; white-space: nowrap; cursor: pointer; }
        .tab-btn.active { background: var(--primary); color: white; }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <img src="logo.jpg" onerror="this.src='https://via.placeholder.com/50?text=Logo'">
            Jija Studio
        </div>
        <div>
            <button class="icon-btn" onclick="openWishlist()">
                <i class="ri-heart-3-line"></i> <span class="badge" id="wCount">0</span>
            </button>
            <button class="icon-btn" onclick="openCart()">
                <i class="ri-shopping-cart-line"></i> <span class="badge" id="cCount">0</span>
            </button>
        </div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="setCat('all', this)">All</button>
        <button class="tab-btn" onclick="setCat('cloth', this)">Fashion</button>
        <button class="tab-btn" onclick="setCat('kids', this)">Kids</button>
        <button class="tab-btn" onclick="setCat('footwear', this)">Footwear</button>
        <button class="tab-btn" onclick="setCat('jewelry', this)">Jewelry</button>
    </div>

    <div class="grid" id="grid"></div>

    <div id="wishModal" class="modal">
        <div class="modal-box">
            <h3>My Wishlist ‚ù§Ô∏è</h3>
            <div id="wishListContainer"></div>
            <button onclick="document.getElementById('wishModal').style.display='none'" class="btn-full" style="background:#333;">Close</button>
        </div>
    </div>

    <div id="checkoutModal" class="modal">
        <div class="modal-box">
            <h3 style="margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">Shipping Address</h3>
            
            <div class="form-grid">
                <div>
                    <label class="form-label">Country</label>
                    <input class="form-input" value="India üáÆüá≥" disabled>
                </div>
                <div>
                    <label class="form-label">State</label>
                    <select class="form-input" id="addrState">
                        <option value="">Select State</option>
                        <option value="Maharashtra">Maharashtra</option>
                        <option value="Karnataka">Karnataka</option>
                        <option value="Delhi">Delhi</option>
                        <option value="Gujarat">Gujarat</option>
                        <option value="Rajasthan">Rajasthan</option>
                        </select>
                </div>
            </div>

            <div class="form-grid">
                <div>
                    <label class="form-label">District</label>
                    <input class="form-input" id="addrDist" placeholder="District Name">
                </div>
                <div>
                    <label class="form-label">Taluka</label>
                    <input class="form-input" id="addrTaluka" placeholder="Taluka Name">
                </div>
            </div>

            <div class="form-grid">
                <div>
                    <label class="form-label">Pincode</label>
                    <input class="form-input" id="addrPin" type="number" placeholder="415xxx">
                </div>
                <div>
                    <label class="form-label">City / Village</label>
                    <input class="form-input" id="addrCity" placeholder="Village Name">
                </div>
            </div>

            <div class="form-full">
                <label class="form-label">Flat / House / Landmark</label>
                <textarea class="form-input" id="addrLocal" rows="2" placeholder="Near Temple, House No 12..."></textarea>
            </div>

            <div style="margin-top:15px; background:#f0fdf4; padding:10px; border-radius:6px; border:1px dashed var(--green); font-size:0.85rem; color:var(--green);">
                <i class="ri-whatsapp-line"></i> Order details will be sent to WhatsApp.
            </div>

            <button class="btn-full" onclick="placeOrder()">PLACE ORDER ON WHATSAPP</button>
            <button onclick="document.getElementById('checkoutModal').style.display='none'" style="width:100%; padding:10px; background:none; border:none; margin-top:5px; cursor:pointer;">Cancel</button>
        </div>
    </div>

    <script>
        const DB_URL = "https://jija-studio-default-rtdb.firebaseio.com/jijaData.json";
        const ORDERS_URL = "https://jija-studio-default-rtdb.firebaseio.com/orders.json";
        const ADMIN_PHONE = "918830903621";
        
        let appData = { products: [], settings: { theme: 'default' } };
        let cart = [];
        let wishlist = JSON.parse(localStorage.getItem('jijaWish')) || [];
        let user = JSON.parse(localStorage.getItem('jijaUser')) || { name: "Guest" };

        window.onload = async () => {
            const r = await fetch(DB_URL);
            const d = await r.json();
            if(d) {
                appData = d;
                if(!appData.products) appData.products=[];
                if(!appData.settings) appData.settings={theme:'default'};
                
                applyTheme(appData.settings.theme); // Apply theme from Admin
                renderHome();
                updateWishIcon();
            }
        };

        // --- ANIMATION ENGINE ---
        function applyTheme(t) {
            const r = document.documentElement.style;
            let symbols = [];

            if(t === 'diwali') { r.setProperty('--primary', '#ea580c'); symbols = ['ü™î','‚ú®','üéÜ']; }
            else if(t === 'christmas') { r.setProperty('--primary', '#15803d'); symbols = ['‚ùÑÔ∏è','üéÑ','‚õÑ']; }
            else if(t === 'holi') { r.setProperty('--primary', '#9333ea'); symbols = ['üü£','üü°','üî¥']; }
            else if(t === 'newyear') { r.setProperty('--primary', '#0f172a'); symbols = ['üéâ','ü•Ç']; }
            else { r.setProperty('--primary', '#D81B60'); }

            if(symbols.length > 0) startRain(symbols);
        }

        function startRain(symbols) {
            setInterval(() => {
                const p = document.createElement('div');
                p.classList.add('theme-particle');
                p.innerText = symbols[Math.floor(Math.random()*symbols.length)];
                p.style.left = Math.random()*100 + 'vw';
                p.style.fontSize = (Math.random()*20+15)+'px';
                p.style.animationDuration = (Math.random()*3+4)+'s';
                document.body.appendChild(p);
                setTimeout(()=>p.remove(), 7000);
            }, 1000);
        }

        function renderHome() {
            document.getElementById('grid').innerHTML = appData.products.map(p => {
                const isWish = wishlist.includes(p.id) ? 'active' : '';
                return `
                <div class="card">
                    <div class="card-img-wrap">
                        <img src="${p.img}">
                        <div class="wish-icon ${isWish}" onclick="toggleWish(${p.id}, this)"><i class="ri-heart-fill"></i></div>
                    </div>
                    <div class="info">
                        <div class="title">${p.name}</div>
                        <div class="price">‚Çπ${p.price}</div>
                        <button onclick="addToCart(${p.id})" style="width:100%; margin-top:5px; padding:5px; background:var(--primary); color:white; border:none; border-radius:4px; cursor:pointer;">Add to Cart</button>
                    </div>
                </div>`;
            }).join('');
        }

        // --- WISHLIST LOGIC ---
        function toggleWish(id, el) {
            if(wishlist.includes(id)) {
                wishlist = wishlist.filter(i => i !== id);
                el.classList.remove('active');
            } else {
                wishlist.push(id);
                el.classList.add('active');
            }
            localStorage.setItem('jijaWish', JSON.stringify(wishlist));
            updateWishIcon();
        }

        function updateWishIcon() {
            document.getElementById('wCount').innerText = wishlist.length;
        }

        function openWishlist() {
            const list = document.getElementById('wishListContainer');
            if(wishlist.length === 0) list.innerHTML = "<p>Wishlist is empty.</p>";
            else {
                list.innerHTML = wishlist.map(id => {
                    const p = appData.products.find(x => x.id === id);
                    if(!p) return '';
                    return `<div style="display:flex; gap:10px; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">
                        <img src="${p.img}" style="width:50px; height:50px; object-fit:cover;">
                        <div><b>${p.name}</b><br>‚Çπ${p.price}</div>
                    </div>`;
                }).join('');
            }
            document.getElementById('wishModal').style.display = 'flex';
        }

        // --- CART & CHECKOUT ---
        function addToCart(id) {
            const p = appData.products.find(x => x.id === id);
            cart.push(p);
            document.getElementById('cCount').innerText = cart.length;
            alert("Added to cart");
        }

        function openCart() {
            if(cart.length === 0) return alert("Cart empty");
            document.getElementById('checkoutModal').style.display = 'flex';
        }

        async function placeOrder() {
            // 1. Gather Address Data
            const state = document.getElementById('addrState').value;
            const dist = document.getElementById('addrDist').value;
            const taluka = document.getElementById('addrTaluka').value;
            const pin = document.getElementById('addrPin').value;
            const city = document.getElementById('addrCity').value;
            const local = document.getElementById('addrLocal').value;

            if(!state || !dist || !taluka || !pin || !city || !local) return alert("Please fill all address fields.");

            const fullAddr = `${local}\nCity: ${city}, Taluka: ${taluka}\nDist: ${dist}, State: ${state} - ${pin}\nCountry: India`;

            // 2. Create Order
            const order = {
                date: new Date().toISOString(),
                user: user,
                address: { city: fullAddr }, // Saving full block as 'city' for admin view simplicity
                cart: cart,
                total: cart.reduce((a,b)=>a+parseInt(b.price),0),
                txnId: "Direct-WA",
                status: "Ordered"
            };

            await fetch(ORDERS_URL, { method: "POST", body: JSON.stringify(order) });

            // 3. WhatsApp Message
            let msg = `*NEW ORDER*\nUser: ${user.name}\n\n*Address:*\n${fullAddr}\n\n*Items:*\n`;
            cart.forEach(i => msg += `- ${i.name} (‚Çπ${i.price})\n`);
            msg += `\n*Total: ‚Çπ${order.total}*`;

            window.open(`https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(msg)}`);
            
            cart = [];
            document.getElementById('cCount').innerText = 0;
            document.getElementById('checkoutModal').style.display = 'none';
            alert("Order Placed!");
        }
    </script>
</body>
</html>
