<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jija Admin - Inventory Manager</title>
    <style>
        :root { --primary: #D81B60; --dark: #2c3e50; --edit: #f39c12; --green: #27ae60; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f7f6; display: flex; }
        .sidebar { width: 250px; background: var(--dark); color: white; min-height: 100vh; padding: 20px; position: fixed; }
        .main-content { margin-left: 250px; padding: 30px; width: 100%; }
        .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: span 2; }
        input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;}
        button { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        /* Stock Grid */
        .stock-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 10px; margin-top: 10px; }
        .stock-item { background: #f9f9f9; padding: 5px; border: 1px solid #eee; text-align: center; border-radius: 4px; }
        .stock-item label { font-size: 11px; display: block; font-weight: bold; margin-bottom: 3px; }
        .stock-item input { width: 100%; text-align: center; padding: 5px; }

        .btn-del { background: #e74c3c; padding: 5px 10px; font-size: 0.8rem; }
        .btn-edit { background: var(--edit); padding: 5px 10px; font-size: 0.8rem; margin-right: 5px; }
        .edit-mode-active { border: 2px solid var(--edit); background-color: #fffaf0; }
        #cancelEditBtn { background: #7f8c8d; display: none; margin-left: 10px; }
        .sc-tag { background: #e0e0e0; padding: 4px 8px; margin: 2px; border-radius: 4px; font-size: 12px; display: inline-block; }
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; background: #e8f8f5; padding: 10px; border: 1px solid #bcece0; border-radius: 5px; margin-top: 15px; }
        .checkbox-wrapper input { width: 20px; height: 20px; margin: 0; }
        
        /* Stock Badge in Table */
        .stock-badge { display: inline-block; background: #e8f5e9; color: #2e7d32; font-size: 11px; padding: 2px 5px; border-radius: 3px; margin: 1px; border: 1px solid #c8e6c9; }
        .stock-zero { background: #ffebee; color: #c62828; border-color: #ffcdd2; }
    </style>
</head>
<body>

<div id="adminLogin" style="position:fixed; inset:0; background:#2c3e50; display:flex; align-items:center; justify-content:center; z-index:9999;">
  <div style="background:white; padding:30px; border-radius:8px; width:300px; text-align:center;">
    <h2 style="color:#D81B60;">Admin Login</h2>
    <input id="adminUser" placeholder="Username" style="width:100%; padding:10px; margin-bottom:10px;">
    <input id="adminPass" type="password" placeholder="Password" style="width:100%; padding:10px; margin-bottom:15px;">
    <button onclick="checkAdminLogin()" style="width:100%; padding:10px; background:#D81B60; color:white; border:none;">Login</button>
    <p id="loginErr" style="color:red; font-size:12px; margin-top:10px;"></p>
  </div>
</div>

<div class="sidebar">
    <h2>Jija Admin</h2>
    <p style="font-size:12px; color:#aaa;">Inventory & Pricing</p>
    <a href="#" style="color:white; text-decoration:none; display:block; margin-top:20px;">Dashboard</a>
    <button onclick="clearAllData()" style="background:red; font-size:12px; margin-top:50px; width:100%;">Reset All Data</button>
</div>

<div class="main-content">
    <h1>Dashboard</h1>

    <div class="card">
      <h3>ðŸŽ¨ Festival Theme</h3>
      <select id="themeSelect" onchange="saveTheme()" style="padding:10px; width:200px;">
        <option value="default">ðŸŒ¸ Default</option>
        <option value="diwali">ðŸŽ† Diwali</option>
        <option value="christmas">ðŸŽ„ Christmas</option>
      </select>
    </div>

    <div class="card">
        <h3>1. Manage Categories</h3>
        <div style="background: #f9f9f9; padding:15px; border-radius:5px;">
            <label><strong>Select Main Category:</strong></label>
            <select id="manageCatSelect" onchange="renderManageSubCats()">
                <option value="cloth">Adult Fashion</option>
                <option value="kids">Kids Wear</option>
                <option value="footwear">Footwear</option>
                <option value="jewelry">Jewelry</option>
                <option value="toy">Toy</option>
            </select>
            <div style="display: flex; gap: 10px; margin-top:10px;">
                <input type="text" id="newSubCat" placeholder="New Sub-Type">
                <button onclick="addSubCategory()" style="width:auto;">Add</button>
            </div>
            <div style="margin-top:10px;"><strong>Current Sub-Types:</strong><div id="manageSubCatList" style="margin-top: 5px;"></div></div>
        </div>
    </div>

    <div class="card" id="productFormCard">
        <h3 id="formTitle">2. Add New Product</h3>
        <div class="form-grid">
            <div><label>Product Name</label><input type="text" id="pName"></div>
            <div>
                <label>Main Category</label>
                <select id="pCat" onchange="toggleCategoryLogic()">
                    <option value="cloth">Adult Fashion</option>
                    <option value="kids">Kids Wear</option>
                    <option value="footwear">Footwear</option>
                    <option value="jewelry">Jewelry</option>
                    <option value="toy">Toy</option>
                </select>
            </div>
            
            <div class="full-width" style="background: #fff8e1; padding: 15px; border-radius: 5px; border: 1px solid #ffe082;">
                <label style="font-weight:bold; color:#f57f17;">ðŸ’° Pricing</label>
                <div class="form-grid" style="margin-top:5px;">
                    <div><label>MRP (Market Price â‚¹)</label><input type="number" id="pMRP" placeholder="e.g. 2000"></div>
                    <div><label>Selling Price (Discounted â‚¹)</label><input type="number" id="pPrice" placeholder="e.g. 1500"></div>
                </div>
            </div>

            <div><label>Sub-Type</label><select id="pSubCat" onchange="renderStockInputs()"><option value="">Select Sub-Type</option></select></div>
            
            <div class="full-width" style="background: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #eee;">
                <label style="font-weight:bold; color:#2c3e50;">ðŸ“¸ Media</label>
                <div class="form-grid" style="margin-top:5px;">
                    <div><label>Main Image URL</label><input type="text" id="pImg"></div>
                    <div><label>Image 2 URL (Opt)</label><input type="text" id="pImg2"></div>
                    <div><label>Image 3 URL (Opt)</label><input type="text" id="pImg3"></div>
                    <div><label>Video URL (Opt)</label><input type="text" id="pVideo"></div>
                </div>
            </div>

            <div class="full-width"><label>Description</label><textarea id="pDesc" rows="2"></textarea></div>
        </div>

        <div class="checkbox-wrapper">
            <input type="checkbox" id="pBanner">
            <label for="pBanner" style="font-weight:bold; color:#27ae60;">Promote in Top Banner Slider?</label>
        </div>

        <div id="stockSection" style="margin-top: 15px; padding: 15px; background: #e8f6f3; border: 1px dashed #27ae60; border-radius: 5px; display:none;">
            <label id="stockLabel" style="color:#27ae60; font-size:1.1rem;"><strong>Inventory Stock:</strong></label>
            <div id="stockContainer" class="stock-grid"></div>
        </div>
        <div id="simpleStockOption" style="display:none; margin-top:15px; padding: 15px; background: #e8f6f3; border: 1px dashed #27ae60;">
            <label style="color:#27ae60; font-size:1.1rem;"><strong>Total Inventory Stock:</strong></label> 
            <input type="number" id="pSimpleStock" value="10">
        </div>

        <div style="margin-top: 20px; display:flex;">
            <button id="submitBtn" onclick="handleFormSubmit()" style="flex:1;">+ Add Product</button>
            <button id="cancelEditBtn" onclick="exitEditMode()">Cancel Edit</button>
        </div>
    </div>

    <div class="card">
        <h3>Inventory List</h3>
        <table width="100%" style="border-collapse: collapse;">
            <thead><tr style="background:#eee; text-align:left;"><th>Img</th><th>Info</th><th>Price</th><th>Live Stock</th><th>Actions</th></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    // --- ðŸ” LOGIN LOGIC ---
    const ADMIN_USER = "Jija Studio";      
    const ADMIN_PASS = "7127";      

    function checkAdminLogin() {
      const u = document.getElementById('adminUser').value;
      const p = document.getElementById('adminPass').value;
      if (u === ADMIN_USER && p === ADMIN_PASS) {
        sessionStorage.setItem('adminLogged', 'yes');
        document.getElementById('adminLogin').style.display = 'none';
      } else {
        document.getElementById('loginErr').innerText = "Wrong login!";
      }
    }

    // --- ðŸŽ¨ THEME LOGIC ---
    function saveTheme() {
      localStorage.setItem('jijaTheme', document.getElementById('themeSelect').value);
      alert("Theme saved!");
    }

    // --- ðŸ›ï¸ INVENTORY LOGIC ---
    let appData = { 
        products: [], 
        subCategories: { 
            cloth: ["Saree", "Suits"], 
            kids: ["Boys", "Girls"], 
            footwear: ["Shoes", "Sandals"], 
            jewelry: ["Necklace", "Bangles"], 
            toy: ["Cars"] 
        } 
    };
    let editingId = null;

    const ADULT_SIZES = ["S", "M", "L", "XL", "XXL", "3XL", "4XL", "5XL", "6XL", "Free Size"];
    const KIDS_SIZES = ["0-1Y", "1-2Y", "2-3Y", "3-4Y", "4-5Y", "5-6Y", "6-7Y", "7-8Y", "8-9Y", "9-10Y", "11-12Y", "13-14Y"];
    const BANGLE_SIZES = ["2-2", "2-4", "2-6", "2-8", "2-10"];
    const FOOTWEAR_SIZES = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];

    window.onload = function() {
        // Check Login
        if (sessionStorage.getItem('adminLogged') === 'yes') {
            document.getElementById('adminLogin').style.display = 'none';
        }

        // Load Theme
        const savedTheme = localStorage.getItem('jijaTheme');
        if(savedTheme) document.getElementById('themeSelect').value = savedTheme;

        // Load Data
        const stored = localStorage.getItem('jijaData');
        if (stored) {
            let parsed = JSON.parse(stored);
            if(Array.isArray(parsed.subCategories)) parsed.subCategories = appData.subCategories;
            if(!parsed.subCategories.footwear) parsed.subCategories.footwear = ["Shoes", "Sandals"];
            appData = parsed;
        }
        renderManageSubCats(); toggleCategoryLogic(); renderTable();
    };

    function saveData() { localStorage.setItem('jijaData', JSON.stringify(appData)); }

    // SUB CATS
    function renderManageSubCats() {
        const main = document.getElementById('manageCatSelect').value;
        const list = appData.subCategories[main] || [];
        document.getElementById('manageSubCatList').innerHTML = list.map(c => `<span class="sc-tag">${c} <span onclick="removeSubCat('${main}','${c}')" style="color:red;cursor:pointer;">&times;</span></span>`).join('');
        if(document.getElementById('pCat').value === main) updateProductSubCatDropdown(main);
    }
    function addSubCategory() {
        const main = document.getElementById('manageCatSelect').value, txt = document.getElementById('newSubCat').value;
        if(txt) { if(!appData.subCategories[main]) appData.subCategories[main] = []; appData.subCategories[main].push(txt); document.getElementById('newSubCat').value=""; saveData(); renderManageSubCats(); }
    }
    function removeSubCat(main, sub) { if(confirm("Remove "+sub+"?")) { appData.subCategories[main] = appData.subCategories[main].filter(c => c !== sub); saveData(); renderManageSubCats(); } }

    // FORM LOGIC
    function updateProductSubCatDropdown(mainCat) {
        const list = appData.subCategories[mainCat] || [];
        document.getElementById('pSubCat').innerHTML = '<option value="">Select Sub-Type</option>' + list.map(c=>`<option value="${c}">${c}</option>`).join('');
    }
    function toggleCategoryLogic() {
        const cat = document.getElementById('pCat').value; updateProductSubCatDropdown(cat);
        // Show Stock Grid for Cloth, Kids, Jewelry AND Footwear
        if(cat === 'cloth' || cat === 'kids' || cat === 'jewelry' || cat === 'footwear') {
            document.getElementById('stockSection').style.display = 'block'; document.getElementById('simpleStockOption').style.display = 'none';
            renderStockInputs(cat);
        } else {
            document.getElementById('stockSection').style.display = 'none'; document.getElementById('simpleStockOption').style.display = 'block';
        }
    }
    function renderStockInputs(cat) {
        if(!cat) cat = document.getElementById('pCat').value;
        const subCat = document.getElementById('pSubCat').value.toLowerCase();
        const container = document.getElementById('stockContainer'); container.innerHTML = "";
        
        let sizes = [];
        if (cat === 'footwear') sizes = FOOTWEAR_SIZES;
        else if (cat === 'kids') sizes = KIDS_SIZES;
        else if (cat === 'jewelry' && subCat.includes('bangle')) sizes = BANGLE_SIZES;
        else if (cat === 'jewelry') sizes = ["Free Size"];
        else if (cat === 'cloth') sizes = ADULT_SIZES;
        else sizes = ["General"];

        sizes.forEach(size => { container.innerHTML += `<div class="stock-item"><label>${size}</label><input type="number" class="size-input" data-label="${size}" placeholder="0"></div>`; });
    }

    // SUBMIT
    function handleFormSubmit() {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        const mrp = document.getElementById('pMRP').value;

        if(!name || !price || !mrp) return alert("Name, Selling Price & MRP are required");
        if(parseFloat(price) > parseFloat(mrp)) return alert("Selling Price cannot be higher than MRP");

        const cat = document.getElementById('pCat').value;
        let stockData = {};
        
        if(document.getElementById('stockSection').style.display !== 'none') {
            document.querySelectorAll('.size-input').forEach(inp => { stockData[inp.getAttribute('data-label')] = parseInt(inp.value) || 0; });
        } else {
            stockData["General"] = parseInt(document.getElementById('pSimpleStock').value) || 0; 
        }

        const productObj = {
            id: editingId ? editingId : Date.now(),
            name: name, price: price, mrp: mrp,
            cat: cat, subCat: document.getElementById('pSubCat').value,
            img: document.getElementById('pImg').value || "https://via.placeholder.com/150",
            img2: document.getElementById('pImg2').value, img3: document.getElementById('pImg3').value, video: document.getElementById('pVideo').value,
            desc: document.getElementById('pDesc').value,
            isBanner: document.getElementById('pBanner').checked,
            stock: stockData
        };

        if(editingId) {
            const index = appData.products.findIndex(p => p.id === editingId);
            appData.products[index] = productObj;
            alert("Updated Successfully!"); exitEditMode();
        } else {
            appData.products.push(productObj); alert("Added!"); clearForm();
        }
        saveData(); renderTable();
    }

    // EDIT
    function editProduct(id) {
        const p = appData.products.find(prod => prod.id === id); if(!p) return;
        editingId = id; 
        document.getElementById('productFormCard').scrollIntoView({ behavior: 'smooth' });
        document.getElementById('productFormCard').classList.add('edit-mode-active');
        document.getElementById('pName').value = p.name; document.getElementById('pPrice').value = p.price; document.getElementById('pMRP').value = p.mrp || p.price;
        document.getElementById('pCat').value = p.cat; document.getElementById('pImg').value = p.img;
        document.getElementById('pImg2').value = p.img2 || ""; document.getElementById('pImg3').value = p.img3 || "";
        document.getElementById('pVideo').value = p.video || ""; document.getElementById('pDesc').value = p.desc || "";
        document.getElementById('pBanner').checked = p.isBanner || false;

        toggleCategoryLogic(); document.getElementById('pSubCat').value = p.subCat;
        renderStockInputs(p.cat);
        
        setTimeout(() => {
            if(document.getElementById('stockSection').style.display !== 'none') {
                document.querySelectorAll('.size-input').forEach(inp => {
                    const label = inp.getAttribute('data-label'); 
                    if(p.stock[label] !== undefined) inp.value = p.stock[label];
                });
            } else { document.getElementById('pSimpleStock').value = p.stock["General"]; }
        }, 100);

        document.getElementById('formTitle').innerText = "2. Edit Inventory / Product"; 
        document.getElementById('submitBtn').innerText = "Update Product & Stock";
        document.getElementById('submitBtn').style.backgroundColor = "#f39c12"; 
        document.getElementById('cancelEditBtn').style.display = "block";
    }

    function exitEditMode() {
        editingId = null; clearForm();
        document.getElementById('formTitle').innerText = "2. Add New Product"; document.getElementById('submitBtn').innerText = "+ Add Product";
        document.getElementById('submitBtn').style.backgroundColor = ""; document.getElementById('cancelEditBtn').style.display = "none";
        document.getElementById('productFormCard').classList.remove('edit-mode-active');
    }
    function clearForm() {
        document.getElementById('pName').value=""; document.getElementById('pPrice').value=""; document.getElementById('pMRP').value="";
        document.getElementById('pImg').value=""; document.getElementById('pImg2').value=""; document.getElementById('pImg3').value=""; 
        document.getElementById('pVideo').value=""; document.getElementById('pDesc').value=""; document.getElementById('pBanner').checked=false;
        document.querySelectorAll('input[type=number]').forEach(i => i.value="");
    }
    function deleteProduct(id) { if(confirm("Delete?")) { appData.products = appData.products.filter(p => p.id !== id); saveData(); renderTable(); } }
    
    function renderTable() {
        const tbody = document.getElementById('tableBody'); tbody.innerHTML = "";
        appData.products.slice().reverse().forEach(p => {
            const bannerBadge = p.isBanner ? '<span style="background:#27ae60; color:white; padding:2px 5px; font-size:10px; border-radius:3px;">BANNER</span>' : '';
            let stockDisplay = "";
            for(const [key, qty] of Object.entries(p.stock)) {
                if(qty > 0) stockDisplay += `<span class="stock-badge">${key}: ${qty}</span>`;
                else stockDisplay += `<span class="stock-badge stock-zero">${key}: 0</span>`;
            }
            tbody.innerHTML += `<tr style="border-bottom:1px solid #ddd;">
                <td><img src="${p.img}" style="width:50px; height:50px; object-fit:cover;"></td>
                <td><b>${p.name}</b> ${bannerBadge}<br><small style="color:#666;">${p.cat} > ${p.subCat}</small></td>
                <td><s style="color:#999">â‚¹${p.mrp||'-'}</s> <b>â‚¹${p.price}</b></td>
                <td><div style="max-width:250px; line-height:1.4;">${stockDisplay || '<span style="color:red">Out of Stock</span>'}</div></td>
                <td><button class="btn-edit" onclick="editProduct(${p.id})">Edit / Restock</button><button class="btn-del" onclick="deleteProduct(${p.id})">Del</button></td>
            </tr>`;
        });
    }
    function clearAllData() { if(confirm("RESET ALL?")) { localStorage.removeItem('jijaData'); location.reload(); } }
</script>
</body>
</html>