<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seller Hub | Jija Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root { 
            --primary: #2874f0; 
            --secondary: #fb641b; 
            --light: #f1f5f9; 
            --dark: #1e293b;
        }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--light); height: 100vh; overflow: hidden; color: #334155; }
        
        /* LOGIN */
        #loginScreen { position: fixed; inset: 0; background: #fff; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .login-box { padding: 40px; border: 1px solid #e2e8f0; border-radius: 8px; width: 300px; text-align: center; }
        .login-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #cbd5e1; border-radius: 6px; text-align: center; }
        .btn { padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; }

        /* DASHBOARD */
        #dashboard { display: none; height: 100%; width: 100%; }
        .sidebar { width: 250px; background: white; border-right: 1px solid #e2e8f0; display: flex; flex-direction: column; padding: 20px; }
        .brand { font-size: 1.2rem; font-weight: bold; color: var(--primary); margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .brand img { width: 40px; height: 40px; border-radius: 50%; }
        .nav-item { padding: 12px; cursor: pointer; color: #64748b; font-weight: 500; display: flex; gap: 10px; align-items: center; }
        .nav-item.active { color: var(--primary); background: #eff6ff; border-radius: 6px; }
        
        .main { flex: 1; padding: 20px; overflow-y: auto; }
        .section { display: none; } .section.active { display: block; }
        
        .card { background: white; padding: 20px; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; outline: none; }
        
        /* ANIMATION */
        .theme-particle { position: fixed; top: -10%; z-index: 9999; animation: fall linear forwards; font-size: 20px; pointer-events: none; }
        @keyframes fall { 100% { transform: translateY(110vh) rotate(360deg); opacity: 0; } }

        /* STOCK */
        .tags-box { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; }
        .tag { background: #f1f5f9; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; display: flex; gap: 5px; }
        .stock-row { display: flex; gap: 10px; }
        .stock-item input { width: 60px; text-align: center; }

        @media (max-width: 768px) {
            #dashboard { flex-direction: column; }
            .sidebar { width: 100%; height: 60px; flex-direction: row; position: fixed; bottom: 0; padding: 5px; justify-content: space-around; border-top: 1px solid #e2e8f0; z-index: 100; }
            .brand { display: none; }
            .nav-item { flex-direction: column; font-size: 0.7rem; gap: 2px; }
            .main { padding-bottom: 80px; }
        }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <img src="logo.jpg" onerror="this.src='https://via.placeholder.com/60?text=Admin'" style="width:60px; border-radius:50%; margin-bottom:10px;">
        <h3>Seller Login</h3>
        <input type="password" id="adminPass" class="login-input" placeholder="Passcode (7127)">
        <button class="btn" onclick="checkPass()">Login</button>
    </div>
</div>

<div id="dashboard">
    <div class="sidebar">
        <div class="brand"><img src="logo.jpg" onerror="this.src='https://via.placeholder.com/40'"> Jija Admin</div>
        <div class="nav-item active" onclick="show(0, this)"><i class="ri-file-list-3-line"></i> Orders</div>
        <div class="nav-item" onclick="show(1, this)"><i class="ri-add-box-line"></i> Add Item</div>
        <div class="nav-item" onclick="show(2, this)"><i class="ri-database-2-line"></i> Inventory</div>
        <div class="nav-item" onclick="show(3, this)"><i class="ri-palette-line"></i> Theme</div>
    </div>

    <div class="main">
        <div class="section active">
            <h2>Orders <button class="btn" onclick="loadData()" style="padding:5px 10px; font-size:0.8rem;">Refresh</button></h2>
            <div class="card">
                <table width="100%" style="border-collapse:collapse;">
                    <thead><tr style="text-align:left; border-bottom:1px solid #eee;"><th>Date</th><th>Customer</th><th>Total</th><th>Status</th></tr></thead>
                    <tbody id="orderList"></tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <h2 id="formTitle">Add Product <button onclick="resetForm()" class="btn" style="background:#ef4444; font-size:0.8rem; display:none;" id="cancelEdit">Cancel</button></h2>
            <div class="card">
                <div class="form-grid">
                    <input id="pName" placeholder="Product Name">
                    <select id="pCat" onchange="renderSub()"><option value="cloth">Fashion</option><option value="kids">Kids</option><option value="footwear">Shoes</option><option value="jewelry">Jewelry</option></select>
                </div>
                <div class="form-grid">
                    <input id="pPrice" type="number" placeholder="Selling Price" oninput="calcDisc()">
                    <input id="pMrp" type="number" placeholder="MRP" oninput="calcDisc()">
                    <input id="pDiscount" placeholder="Discount %" readonly style="background:#f8f9fa;">
                </div>
                <div style="margin-bottom:15px;">
                    <select id="pSubDropdown" style="margin-bottom:5px;"><option value="">Select Sub-Category</option></select>
                    <button class="btn" style="padding:5px 10px; font-size:0.8rem;" onclick="addTag()">Add Tag</button>
                    <div id="tagsBox" class="tags-box" style="margin-top:5px;"></div>
                </div>
                <div class="form-grid">
                    <input id="pImg" placeholder="Main Image URL">
                    <input id="pImg2" placeholder="Image 2">
                    <input id="pImg3" placeholder="Image 3">
                </div>
                <textarea id="pDesc" rows="3" placeholder="Description" style="margin-bottom:15px;"></textarea>
                <div>
                    <label>Inventory:</label>
                    <div id="stockRow" class="stock-row"></div>
                </div>
                <div style="margin-top:15px;">
                    <input type="checkbox" id="pBanner"> Show in Slider
                </div>
                <button class="btn" style="width:100%; margin-top:15px;" onclick="saveProduct()">Save Product</button>
            </div>
        </div>

        <div class="section">
            <h2>Inventory</h2>
            <div id="invList"></div>
        </div>

        <div class="section">
            <h2>Theme</h2>
            <div class="card">
                <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap:10px;">
                    <button class="btn" onclick="setTheme('default')">Default</button>
                    <button class="btn" onclick="setTheme('diwali')">Diwali</button>
                    <button class="btn" onclick="setTheme('christmas')">Christmas</button>
                    <button class="btn" onclick="setTheme('holi')">Holi</button>
                    <button class="btn" onclick="setTheme('valentine')">Valentine</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const DB_URL = "https://jija-studio-default-rtdb.firebaseio.com/jijaData.json";
    const ORDERS_URL = "https://jija-studio-default-rtdb.firebaseio.com/orders.json";
    let appData = { products: [], subCategories: {}, settings: {theme:'default'} };
    let editId = null, currentTags = [];
    const SIZES = { cloth: ["S","M","L","XL","XXL"], kids: ["0-1Y","2-3Y","4-5Y"], footwear: [6,7,8,9,10] };

    function checkPass() {
        if(document.getElementById('adminPass').value === '7127') {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex';
            loadData();
        } else alert("Wrong");
    }

    function show(idx, btn) {
        document.querySelectorAll('.section').forEach((s, i) => s.classList.toggle('active', i === idx));
        document.querySelectorAll('.nav-item').forEach((n, i) => n.classList.toggle('active', i === idx));
        if(idx===1 && !editId) renderSub();
        if(idx===2) renderInv();
    }

    async function loadData() {
        const r = await fetch(DB_URL);
        const d = await r.json();
        if(d) {
            appData = d;
            if(!appData.products) appData.products=[];
            if(!appData.subCategories || Array.isArray(appData.subCategories)) appData.subCategories = { cloth:["Saree"], kids:["Frock"], footwear:["Shoes"], jewelry:["Necklace"] };
            applyTheme(appData.settings.theme);
        }
        const r2 = await fetch(ORDERS_URL);
        const o = await r2.json();
        renderOrders(o);
    }

    async function saveData() { await fetch(DB_URL, { method: "PUT", body: JSON.stringify(appData) }); }

    /* THEME & ANIMATION */
    function applyTheme(t) {
        let r = document.documentElement.style;
        let s = [];
        if(t==='diwali') { r.setProperty('--primary', '#d84315'); s=['ðŸª”','âœ¨']; }
        else if(t==='christmas') { r.setProperty('--primary', '#1b5e20'); s=['â„ï¸','ðŸŽ„']; }
        else if(t==='holi') { r.setProperty('--primary', '#7b1fa2'); s=['ðŸŸ£','ðŸŸ¡']; }
        else if(t==='valentine') { r.setProperty('--primary', '#c2185b'); s=['â¤ï¸','ðŸ’–']; }
        else { r.setProperty('--primary', '#2874f0'); s=[]; } // Default
        
        // Clear existing particles
        document.querySelectorAll('.theme-particle').forEach(e=>e.remove());
        if(s.length) startRain(s);
    }

    function startRain(s) {
        setInterval(()=>{
            let p = document.createElement('div');
            p.className='theme-particle';
            p.innerText=s[Math.floor(Math.random()*s.length)];
            p.style.left=Math.random()*100+'vw';
            p.style.animationDuration=(Math.random()*3+2)+'s';
            document.body.appendChild(p);
            setTimeout(()=>p.remove(),5000);
        }, 800);
    }

    function setTheme(t) { appData.settings.theme = t; saveData(); applyTheme(t); alert("Theme Applied"); }

    /* PRODUCT */
    function calcDisc() {
        const p = parseFloat(document.getElementById('pPrice').value);
        const m = parseFloat(document.getElementById('pMrp').value);
        if(p && m && m>p) document.getElementById('pDiscount').value = Math.round(((m-p)/m)*100) + "% OFF";
        else document.getElementById('pDiscount').value = "";
    }

    function renderSub() {
        const cat = document.getElementById('pCat').value;
        const subs = appData.subCategories[cat] || [];
        document.getElementById('pSubDropdown').innerHTML = '<option value="">Select Tag...</option>' + subs.map(s=>`<option>${s}</option>`).join('');
        document.getElementById('stockRow').innerHTML = (SIZES[cat] || ["Std"]).map(s=>`<div class="stock-item"><small>${s}</small><br><input class="stk-in" data-s="${s}" type="number" value="0"></div>`).join('');
        renderTags();
    }

    function addTag() { 
        const val = document.getElementById('pSubDropdown').value; 
        if(val && !currentTags.includes(val)) { currentTags.push(val); renderTags(); } 
    }
    function renderTags() { document.getElementById('tagsBox').innerHTML = currentTags.map(t=>`<div class="tag">${t} <span onclick="currentTags=currentTags.filter(x=>x!='${t}');renderTags()" style="cursor:pointer;">x</span></div>`).join(''); }

    function saveProduct() {
        let stock={}; document.querySelectorAll('.stk-in').forEach(i=>stock[i.dataset.s]=parseInt(i.value)||0);
        const p = {
            id: editId || Date.now(),
            name: document.getElementById('pName').value,
            cat: document.getElementById('pCat').value,
            subCats: currentTags,
            price: document.getElementById('pPrice').value,
            mrp: document.getElementById('pMrp').value,
            discount: document.getElementById('pDiscount').value,
            img: document.getElementById('pImg').value,
            img2: document.getElementById('pImg2').value,
            img3: document.getElementById('pImg3').value,
            desc: document.getElementById('pDesc').value,
            isBanner: document.getElementById('pBanner').checked,
            stock
        };
        if(editId) appData.products[appData.products.findIndex(x=>x.id==editId)] = p;
        else appData.products.push(p);
        saveData(); resetForm(); alert("Saved");
    }

    function startEdit(id) {
        const p = appData.products.find(x=>x.id==id);
        editId=id;
        document.getElementById('formTitle').innerText = "Edit Product";
        document.getElementById('cancelEdit').style.display = "inline-block";
        document.getElementById('pName').value=p.name;
        document.getElementById('pCat').value=p.cat;
        document.getElementById('pPrice').value=p.price;
        document.getElementById('pMrp').value=p.mrp||"";
        document.getElementById('pDiscount').value=p.discount||"";
        document.getElementById('pImg').value=p.img;
        document.getElementById('pDesc').value=p.desc||"";
        document.getElementById('pBanner').checked=p.isBanner;
        currentTags = p.subCats||[];
        renderSub();
        show(1, document.querySelectorAll('.nav-item')[1]);
    }

    function resetForm() {
        editId=null; currentTags=[];
        document.querySelectorAll('input,textarea').forEach(i=>i.value='');
        document.getElementById('formTitle').innerText="Add Product";
        document.getElementById('cancelEdit').style.display="none";
        renderSub();
    }

    function renderInv() {
        document.getElementById('invList').innerHTML = appData.products.map(p=>`
            <div style="display:flex; gap:10px; background:white; padding:10px; margin-bottom:10px; border:1px solid #eee;">
                <img src="${p.img}" style="width:50px; height:50px; object-fit:cover;">
                <div style="flex:1;"><b>${p.name}</b><br><small>${p.cat}</small></div>
                <button class="btn" style="padding:5px;" onclick="startEdit(${p.id})">Edit</button>
            </div>
        `).join('');
    }

    function renderOrders(d) {
        document.getElementById('orderList').innerHTML = d ? Object.entries(d).reverse().map(([k,v])=>`
            <tr style="border-bottom:1px solid #eee;">
                <td style="padding:10px;">${new Date(v.date).toLocaleDateString()}</td>
                <td>${v.user.name}<br><small>${v.user.phone}</small></td>
                <td>${v.total}</td>
                <td>${v.status}</td>
            </tr>
        `).join('') : "<tr><td colspan=4>No Orders</td></tr>";
    }
</script>
</body>
</html>
